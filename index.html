<!DOCTYPE html>

<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>StreamGids</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <style>
    :root {
      --bg: #050509;
      --card: #11111b;
      --accent: #0a84ff;
      --accent2: #32d74b;
      --t1: #f5f5f7;
      --t2: #a1a1b2;
      --t3: #6b6b7a;
      --s3: #232331;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",system-ui,sans-serif;
      background:radial-gradient(circle at top,#141420 0,#050509 55%);
      color:var(--t1);
      -webkit-font-smoothing:antialiased;
    }
    .app{
      min-height:100vh;
      max-width:900px;
      margin:0 auto;
      padding:24px 16px 40px;
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:18px;
    }
    .logo-wrap{ display:flex; align-items:center; gap:10px; }
    .logo-dot{
      width:26px; height:26px; border-radius:9px;
      background:radial-gradient(circle at 30% 20%,#fff 0,rgba(255,255,255,0.35) 40%,transparent 65%),
                 linear-gradient(135deg,#0a84ff,#32d74b);
      box-shadow:0 0 0 0.5px rgba(255,255,255,0.35),0 8px 18px rgba(0,0,0,0.7);
    }
    .title-main{ font-weight:600; letter-spacing:-0.02em; font-size:20px; }
    .title-sub{ font-size:12px; color:var(--t3); }

```
.pill-row{ display:flex; gap:8px; margin-bottom:12px; }
.pill{
  padding:6px 12px; border-radius:999px;
  border:1px solid rgba(255,255,255,0.08);
  background:rgba(255,255,255,0.03);
  color:var(--t2); font-size:12px;
  display:flex; align-items:center; gap:6px;
  cursor:pointer; transition:all .18s ease;
}
.pill.active{
  border-color:rgba(10,132,255,0.7);
  background:linear-gradient(135deg,rgba(10,132,255,0.2),rgba(50,215,75,0.08));
  color:var(--t1); box-shadow:0 0 0 1px rgba(10,132,255,0.3);
}
.pill span.icon{ font-size:14px; }

.svc-bar{
  display:flex; overflow-x:auto;
  gap:8px; padding:6px 2px 6px 0;
  margin-bottom:8px; -webkit-overflow-scrolling:touch;
}
.svc-bar::-webkit-scrollbar{display:none}
.sc{
  flex:0 0 auto; display:flex; align-items:center; gap:6px;
  padding:6px 10px; border-radius:999px;
  background:rgba(15,15,24,0.9);
  border:1px solid rgba(255,255,255,0.06);
  color:var(--t2); font-size:11px; cursor:pointer;
  transition:all .16s ease;
}
.sc img{ width:16px; height:16px; border-radius:4px; object-fit:cover; }
.sc .dot{ width:10px; height:10px; border-radius:999px; }
.sc.active{
  border-color:rgba(10,132,255,0.75);
  background:linear-gradient(135deg,rgba(10,132,255,0.25),rgba(50,215,75,0.12));
  color:var(--t1); box-shadow:0 0 0 1px rgba(10,132,255,0.4);
}

.nav-bar{
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:8px; gap:8px;
}
.nav-btn{
  display:flex; align-items:center; gap:6px;
  padding:8px 14px; border-radius:999px;
  border:1px solid rgba(255,255,255,0.1);
  background:rgba(255,255,255,0.04);
  color:var(--t2); font-size:12px; font-weight:500;
  cursor:pointer; transition:all .16s ease;
  white-space:nowrap;
}
.nav-btn:hover:not(:disabled){ border-color:rgba(10,132,255,0.5); color:var(--t1); }
.nav-btn:disabled{ opacity:0.3; cursor:default; pointer-events:none; }
.nav-range{ font-size:12px; color:var(--t3); text-align:center; flex:1; }

.loading-screen,.error-screen{
  min-height:50vh; display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  text-align:center; color:var(--t2);
}
.spinner{
  width:22px; height:22px; border-radius:999px;
  border:2px solid rgba(255,255,255,0.08);
  border-top-color:var(--accent);
  animation:spin 0.8s linear infinite;
  margin-bottom:14px;
}
.loading-text{ font-size:14px; }
.error-icon{ font-size:32px; margin-bottom:10px; }
.error-title{ font-weight:600; margin-bottom:4px; }
.error-msg{ font-size:13px; color:var(--t3); max-width:260px; margin:0 auto 14px; }
.retry-btn{
  border:none; outline:none; padding:8px 16px; border-radius:999px;
  background:var(--accent); color:#fff; font-size:13px;
  font-weight:500; cursor:pointer;
  box-shadow:0 6px 16px rgba(10,132,255,0.6);
}

.day-section{
  margin-top:18px; padding:16px 12px 18px;
  border-radius:18px;
  background:linear-gradient(145deg,rgba(17,17,26,0.96),rgba(8,8,14,0.98));
  border:1px solid rgba(255,255,255,0.04);
  box-shadow:0 16px 35px rgba(0,0,0,0.75);
  animation:fadeUp .35s ease forwards;
  opacity:0; transform:translateY(8px);
}
.day-header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:2px; }
.day-name{ font-size:14px; font-weight:600; letter-spacing:0.01em; }
.today-chip{
  font-size:11px; padding:3px 8px; border-radius:999px;
  background:rgba(10,132,255,0.15); color:var(--accent);
  border:1px solid rgba(10,132,255,0.55);
}
.day-sub{ font-size:12px; color:var(--t3); margin-bottom:8px; }
.cat-row{ font-size:12px; color:var(--t2); margin:10px 0 6px; }

.scroll-track{
  display:flex; gap:10px; overflow-x:auto;
  padding-bottom:4px; margin-bottom:6px;
  -webkit-overflow-scrolling:touch;
}
.scroll-track::-webkit-scrollbar{height:0}

.card{
  flex:0 0 142px; background:var(--card);
  border-radius:16px; border:1px solid rgba(255,255,255,0.06);
  padding:6px 6px 10px; cursor:pointer;
  transition:transform .16s ease,box-shadow .16s ease,background .16s ease,border-color .16s ease;
  box-shadow:0 10px 22px rgba(0,0,0,0.7);
}
.card:hover{
  transform:translateY(-2px);
  box-shadow:0 16px 30px rgba(0,0,0,0.9);
  border-color:rgba(10,132,255,0.5);
  background:radial-gradient(circle at top,rgba(10,132,255,0.16),var(--card));
}
.card-poster{
  position:relative; border-radius:12px; overflow:hidden;
  background:var(--s3); margin-bottom:6px; aspect-ratio:2/3;
}
.card-poster img.poster{
  width:100%; height:100%; object-fit:cover; display:block; background:#000;
}
.fallback{
  position:absolute; inset:0; display:flex;
  align-items:center; justify-content:center;
  padding:8px; color:var(--t2); font-size:11px; text-align:center;
}
.new-label{
  position:absolute; top:6px; left:6px; font-size:10px;
  padding:2px 6px; border-radius:999px;
  background:rgba(50,215,75,0.92); color:#000; font-weight:600;
}
.badge{
  position:absolute; bottom:6px; left:6px; font-size:10px;
  padding:2px 6px; border-radius:999px;
  display:inline-flex; align-items:center;
  max-width:70%; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  backdrop-filter:blur(12px);
}
.card-title{
  font-size:12px; font-weight:500; line-height:1.2;
  margin-bottom:2px; max-height:2.4em; overflow:hidden;
}
.card-meta{ font-size:11px; color:var(--t3); }
.divider{ margin-top:10px; height:1px; background:linear-gradient(to right,rgba(255,255,255,0.12),rgba(255,255,255,0.02)); }
.empty-day{ font-size:13px; color:var(--t3); padding:8px 0; }

#overlay{
  position:fixed; inset:0;
  background:rgba(3,3,8,0.88);
  backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px);
  display:none; align-items:flex-end; justify-content:center; z-index:20;
}
#overlay.open{display:flex;}
.sheet{
  width:100%; max-width:640px;
  border-radius:22px 22px 0 0;
  background:linear-gradient(160deg,#101018,#06060d);
  padding:14px 16px 18px;
  border:1px solid rgba(255,255,255,0.08); border-bottom:none;
  box-shadow:0 -18px 40px rgba(0,0,0,0.95);
  max-height:85vh; display:flex; flex-direction:column;
  animation:slideUp .28s ease-out;
}
.drag{ width:36px; height:4px; border-radius:999px; background:rgba(255,255,255,0.2); margin:0 auto 8px; }
.sheet-header{ display:flex; gap:12px; margin-bottom:10px; }
.sp{ width:84px; height:126px; border-radius:14px; overflow:hidden; background:var(--s3); flex-shrink:0; }
.sp img{ width:100%; height:100%; object-fit:cover; }
.sinf{ flex:1; min-width:0; }
.ssvc{ font-size:11px; text-transform:uppercase; letter-spacing:0.08em; color:var(--t2); margin-bottom:3px; }
.stitle{ font-size:16px; font-weight:600; margin-bottom:2px; }
.smeta{ font-size:12px; color:var(--t3); margin-bottom:4px; }
.stags{ font-size:11px; margin-bottom:4px; }
.stag{ display:inline-block; padding:2px 7px; border-radius:999px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.14); margin-right:4px; margin-bottom:3px; }
.srating{ font-size:12px; color:var(--t2); }
.sheet-body{ font-size:13px; color:var(--t2); line-height:1.6; overflow:auto; padding-right:2px; margin-bottom:8px; }
.watch-btn{
  width:100%; display:flex; align-items:center; justify-content:center; gap:6px;
  padding:9px 14px; border-radius:999px; border:none; outline:none;
  background:linear-gradient(135deg,#0a84ff,#32d74b);
  color:#fff; font-size:14px; font-weight:600;
  text-decoration:none; margin-top:4px;
  box-shadow:0 8px 22px rgba(10,132,255,0.8); cursor:pointer;
}

@keyframes spin{to{transform:rotate(360deg)}}
@keyframes fadeUp{to{opacity:1;transform:translateY(0)}}
@keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
@media(min-width:768px){.app{padding-top:28px}}
```

  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo-wrap">
      <div class="logo-dot"></div>
      <div>
        <div class="title-main">StreamGids</div>
        <div class="title-sub">Nieuwe originals op streaming</div>
      </div>
    </div>
  </header>

  <div class="pill-row">
    <div class="pill active" data-f="all"   onclick="setType(this)"><span class="icon">‚óé</span>Alles</div>
    <div class="pill"        data-f="movie" onclick="setType(this)"><span class="icon">üéû</span>Films</div>
    <div class="pill"        data-f="tv"    onclick="setType(this)"><span class="icon">üì°</span>Series</div>
  </div>

  <div id="svcBar" class="svc-bar"></div>

  <div class="nav-bar" id="navBar" style="display:none">
    <button class="nav-btn" id="btnPrev" onclick="shiftWindow(-7)">‚óÄ Ga terug</button>
    <div class="nav-range" id="navRange"></div>
    <button class="nav-btn" id="btnNext" onclick="shiftWindow(7)">Ga verder ‚ñ∂</button>
  </div>

  <main id="main">
    <div class="loading-screen">
      <div class="spinner"></div>
      <div class="loading-text">Laden‚Ä¶</div>
    </div>
  </main>
</div>

<div id="overlay" onclick="closeBg(event)">
  <div class="sheet">
    <div class="drag"></div>
    <div class="sheet-header"><div id="si"></div></div>
    <div id="sd" class="sheet-body"></div>
    <a id="wb" class="watch-btn" href="#" target="_blank" rel="noopener noreferrer" style="display:none">
      <span>‚ñ∂</span> Nu kijken
    </a>
  </div>
</div>

<script>
const API_KEY = 'eLLuTN9mYhAAWBNl1P3XOGgRKFA1toAVWhOiYX3m';
const WM      = 'https://api.watchmode.com/v1';

// ‚îÄ‚îÄ Alleen streamers die eigen originals produceren ‚îÄ‚îÄ
// Dit zijn de services waarbij US-releasedata ook geldt voor NL
const ORIGINAL_PRODUCERS = [
  'netflix', 'disney', 'max', 'hbo', 'apple', 'appletv',
  'prime', 'amazon', 'paramount', 'peacock', 'hulu', 'videoland'
];

const SVC_COLORS = {
  'netflix':    { color:'#E50914', text:'#fff' },
  'disney':     { color:'#113CCF', text:'#fff' },
  'max':        { color:'#5822B4', text:'#fff' },
  'hbo':        { color:'#5822B4', text:'#fff' },
  'apple':      { color:'#555',    text:'#fff' },
  'appletv':    { color:'#555',    text:'#fff' },
  'prime':      { color:'#00A8E0', text:'#fff' },
  'amazon':     { color:'#00A8E0', text:'#fff' },
  'paramount':  { color:'#0064FF', text:'#fff' },
  'peacock':    { color:'#F5A800', text:'#000' },
  'hulu':       { color:'#1CE783', text:'#000' },
  'videoland':  { color:'#E00000', text:'#fff' },
  'default':    { color:'#444',    text:'#fff' },
};

function getSvcStyle(name='') {
  const lo = name.toLowerCase();
  const k  = Object.keys(SVC_COLORS).find(k => lo.includes(k));
  return SVC_COLORS[k] || SVC_COLORS.default;
}

// Een bron telt alleen mee als het een original-producer is
function isOriginalProducer(name) {
  return ORIGINAL_PRODUCERS.some(s => (name||'').toLowerCase().includes(s));
}

async function translateToNL(text) {
  if (!text || !text.trim()) return 'Geen beschrijving beschikbaar.';
  const dw = ['de','het','een','en','van','in','is','dat','zijn','met','op','voor'];
  if ((text||'').toLowerCase().split(/\s+/).filter(w => dw.includes(w)).length >= 3) return text;
  try {
    const r = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text.slice(0,500))}&langpair=en|nl`);
    const d = await r.json();
    const t = d?.responseData?.translatedText;
    return (t && t !== text) ? t : text;
  } catch { return text; }
}

// ‚îÄ‚îÄ State ‚îÄ‚îÄ
let sources    = [];
let allItems   = [];
let typeFilter = 'all';
let svcFilter  = 'all';
const WINDOW_SIZE = 7;
let allDays = [], windowStart = 0;
const detailCache = {};

function dateStr(offset=0) {
  const d = new Date(); d.setDate(d.getDate()+offset);
  return d.toISOString().slice(0,10).replace(/-/g,'');
}
function isoDate(v) {
  if (!v) return '';
  const s = String(v);
  if (s.includes('-')) return s.slice(0,10);
  return `${s.slice(0,4)}-${s.slice(4,6)}-${s.slice(6,8)}`;
}
function todayISO() { return new Date().toISOString().slice(0,10); }
function dayName(iso) {
  const n = new Date(iso+'T12:00:00').toLocaleDateString('nl-NL',{weekday:'long'});
  return n.charAt(0).toUpperCase() + n.slice(1);
}
function fullDate(iso) {
  return new Date(iso+'T12:00:00').toLocaleDateString('nl-NL',{day:'numeric',month:'long',year:'numeric'});
}
function shortDate(iso) {
  return new Date(iso+'T12:00:00').toLocaleDateString('nl-NL',{day:'numeric',month:'short'});
}
function setTxt(t) { const el = document.querySelector('.loading-text'); if(el) el.textContent=t; }

async function wm(path, params={}) {
  const url = new URL(WM+path);
  url.searchParams.set('apiKey', API_KEY);
  Object.entries(params).forEach(([k,v]) => url.searchParams.set(k,v));
  const r = await fetch(url.toString());
  if (!r.ok) throw new Error(`WatchMode ${r.status}`);
  return r.json();
}

// ‚îÄ‚îÄ 1. Sources ‚Äì gebruik US regio voor betere datadekking ‚îÄ‚îÄ
async function fetchSources() {
  const data = await wm('/sources', { regions: 'US' });
  sources = (Array.isArray(data) ? data : [])
    .filter(s => s.type === 'sub' && s.regions?.includes('US') && isOriginalProducer(s.name))
    .sort((a,b) => (a.name||'').localeCompare(b.name||''));
}

// ‚îÄ‚îÄ 2. Releases ‚Äì US regio, alleen van original producers ‚îÄ‚îÄ
// Type wordt uitsluitend bepaald door het endpoint (films-call ‚Üí movie, series-call ‚Üí tv)
async function fetchReleases() {
  const from = dateStr(-30), to = dateStr(30);

  const [movRes, tvRes] = await Promise.all([
    wm('/releases', { regions:'US', start_date:from, end_date:to, types:'movie', limit:250 }),
    wm('/releases', { regions:'US', start_date:from, end_date:to, types:'tv_series,tv_miniseries,tv_special', limit:250 }),
  ]);

  function parse(res, forcedType) {
    return (res?.releases || []).map(item => {
      const src = sources.find(s => s.id === item.source_id) || {};
      // Sla over als de bron geen original producer is
      if (!isOriginalProducer(src.name || item.source_name || '')) return null;
      const style = getSvcStyle(src.name || item.source_name || '');
      return {
        ...item,
        img:   item.poster_url || null,
        _type: forcedType,          // strikt: altijd endpoint-type gebruiken
        _date: isoDate(item.source_release_date),
        _src:  src.id ? src : { name: item.source_name || 'Streaming' },
        _style: style,
      };
    }).filter(Boolean);
  }

  const movies = parse(movRes, 'movie');
  const tv     = parse(tvRes,  'tv');

  const seen = new Set();
  allItems = [...movies, ...tv].filter(i => {
    const k = `${i.id}-${i.source_id}-${i._type}`;
    if (seen.has(k) || !i._date) return false;
    seen.add(k); return true;
  });
}

// ‚îÄ‚îÄ Filter & group ‚îÄ‚îÄ
function filteredItems() {
  return allItems.filter(i => {
    if (typeFilter === 'movie' && i._type !== 'movie') return false;
    if (typeFilter === 'tv'    && i._type !== 'tv')    return false;
    if (svcFilter  !== 'all'  && String(i.source_id) !== String(svcFilter)) return false;
    return !!i._date;
  });
}

function buildDayList() {
  const s = new Set();
  for (let i = -30; i <= 30; i++) {
    const d = new Date(); d.setDate(d.getDate()+i);
    s.add(d.toISOString().slice(0,10));
  }
  filteredItems().forEach(i => s.add(i._date));
  allDays = [...s].sort();

  const today = todayISO();
  let idx = allDays.indexOf(today);
  if (idx === -1) idx = allDays.findIndex(d => d >= today);
  if (idx === -1) idx = Math.max(0, allDays.length - WINDOW_SIZE);
  windowStart = idx;
}

function grouped() {
  const map = {};
  filteredItems().forEach(i => {
    if (!map[i._date]) map[i._date] = { movies:[], tv:[] };
    if (i._type === 'movie') map[i._date].movies.push(i);
    else map[i._date].tv.push(i);
  });
  return map;
}

// ‚îÄ‚îÄ Navigatie ‚îÄ‚îÄ
function shiftWindow(delta) {
  windowStart = Math.max(0, Math.min(allDays.length - WINDOW_SIZE, windowStart + delta));
  renderAll();
  window.scrollTo({ top:0, behavior:'smooth' });
}
function updateNavBar() {
  const bar = document.getElementById('navBar');
  if (!allDays.length) { bar.style.display='none'; return; }
  bar.style.display = 'flex';
  const vis = allDays.slice(windowStart, windowStart + WINDOW_SIZE);
  document.getElementById('navRange').textContent = vis.length
    ? `${shortDate(vis[0])} ‚Äì ${shortDate(vis[vis.length-1])}` : '';
  document.getElementById('btnPrev').disabled = windowStart <= 0;
  document.getElementById('btnNext').disabled = windowStart + WINDOW_SIZE >= allDays.length;
}

// ‚îÄ‚îÄ Render ‚îÄ‚îÄ
function renderAll() {
  const main = document.getElementById('main');
  main.innerHTML = '';
  const g = grouped(), today = todayISO();
  const vis = allDays.slice(windowStart, windowStart + WINDOW_SIZE);
  let count = 0;

  vis.forEach(iso => {
    const data = g[iso], movies = data?.movies||[], tv = data?.tv||[];
    count++;
    const sec = document.createElement('section');
    sec.className = 'day-section';
    sec.style.animationDelay = `${count * 0.04}s`;
    const chip = iso === today ? '<span class="today-chip">Vandaag</span>' : '';
    let html = `
      <div class="day-header"><div class="day-name">${dayName(iso)}</div>${chip}</div>
      <div class="day-sub">${fullDate(iso)}</div>`;
    if (!movies.length && !tv.length) {
      html += `<div class="empty-day">Geen nieuwe originals op deze dag.</div>`;
    } else {
      if (movies.length) html += `<div class="cat-row">üéû &nbsp;Films (${movies.length})</div><div class="scroll-track">${movies.map(cardHtml).join('')}</div>`;
      if (tv.length)     html += `<div class="cat-row">üì° &nbsp;Series (${tv.length})</div><div class="scroll-track">${tv.map(cardHtml).join('')}</div>`;
    }
    html += '<div class="divider"></div>';
    sec.innerHTML = html;
    main.appendChild(sec);
  });

  if (!vis.length)
    main.innerHTML = `<div class="loading-screen"><div class="loading-text">Geen originals gevonden.</div></div>`;
  updateNavBar();
}

function cardHtml(item) {
  const title   = (item.title||'').replace(/'/g,"&#39;").replace(/"/g,'&quot;');
  const style   = item._style;
  const svcName = (item._src?.name || item.source_name || 'Streaming').replace(/United States/i,'').trim();
  const imgEl   = item.img
    ? `<img class="poster" src="${item.img}" alt="${title}" loading="lazy" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">`
    : '';
  const fallD   = item.img ? 'none' : 'flex';
  const rating  = item.user_rating
    ? `‚≠ê ${Number(item.user_rating).toFixed(1)}`
    : (item._type === 'movie' ? 'Film' : 'Serie');
  return `
    <div class="card" onclick="openModal(${item.id||0},'${item._type}','${item.watchmode_id||item.id||0}')">
      <div class="card-poster">
        ${imgEl}
        <div class="fallback" style="display:${fallD}"><span>${title}</span></div>
        <div class="new-label">Nieuw</div>
        <div class="badge" style="background:${style.color}dd;color:${style.text}">${svcName}</div>
      </div>
      <div class="card-title">${title}</div>
      <div class="card-meta">${rating}</div>
    </div>`;
}

// ‚îÄ‚îÄ Service bar ‚îÄ‚îÄ
function buildSvcBar() {
  const bar = document.getElementById('svcBar');
  bar.innerHTML = `<div class="sc active" data-id="all" onclick="setSvc(this)">Alle streamers</div>`;
  const foundIds = new Set(allItems.map(i => String(i.source_id)));
  sources.filter(s => foundIds.has(String(s.id))).forEach(s => {
    const style = getSvcStyle(s.name||'');
    const name  = (s.name||'').replace(/United States/i,'').trim();
    const logo  = s.logo_100px
      ? `<img src="${s.logo_100px}" alt="">`
      : `<div class="dot" style="background:${style.color}"></div>`;
    bar.innerHTML += `<div class="sc" data-id="${s.id}" onclick="setSvc(this)">${logo}${name}</div>`;
  });
}

// ‚îÄ‚îÄ Filters ‚îÄ‚îÄ
function setType(el) {
  typeFilter = el.dataset.f;
  document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
  el.classList.add('active');
  buildDayList(); renderAll();
}
function setSvc(el) {
  svcFilter = el.dataset.id;
  document.querySelectorAll('.sc').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  buildDayList(); renderAll();
}

// ‚îÄ‚îÄ Modal ‚îÄ‚îÄ
async function openModal(id, type, wmId) {
  const overlay = document.getElementById('overlay');
  const si = document.getElementById('si'), sd = document.getElementById('sd'), wb = document.getElementById('wb');

  const item = allItems.find(i => (i.id===id || i.watchmode_id===id) && i._type===type)
            || allItems.find(i => String(i.watchmode_id||i.id) === String(wmId));
  const title   = item?.title || '‚Äî';
  const poster  = item?.img   || '';
  const svcName = (item?._src?.name || item?.source_name || 'Streaming').replace(/United States/i,'').trim();
  const style   = item?._style || getSvcStyle('');

  si.innerHTML = `
    <div class="sp">${poster ? `<img src="${poster}" alt="">` : ''}</div>
    <div class="sinf">
      <div class="ssvc" style="color:${style.color}">${svcName}</div>
      <div class="stitle">${title}</div>
      <div class="smeta">${type==='movie'?'üéû Film':'üì° Serie'}</div>
      <div style="color:var(--t3);font-size:12px">Details laden‚Ä¶</div>
    </div>`;
  sd.textContent = ''; wb.style.display = 'none';
  overlay.classList.add('open'); document.body.style.overflow = 'hidden';

  const key = String(wmId || id);
  if (!detailCache[key] && key !== '0') {
    try { detailCache[key] = await wm(`/title/${key}/details`); }
    catch { detailCache[key] = null; }
  }

  const d = detailCache[key];
  const fullTitle = d?.title || title;
  const year      = d?.year  || (item?._date||'').slice(0,4);
  const runtime   = d?.runtime_minutes ? `${d.runtime_minutes} min` : '';
  const rating    = d?.user_rating ? `${Number(d.user_rating).toFixed(1)} / 10` : '';

  const genres = (d?.genres||[]).slice(0,4).map(g => {
    const n = typeof g==='object' ? (g.name||'') : (typeof g==='string' ? g : '');
    return (!n || !isNaN(n.trim())) ? '' : `<span class="stag">${n}</span>`;
  }).filter(Boolean).join('');

  const posterUrl = d?.poster || item?.img || '';

  // Kijklink ‚Äì prioriteit aan NL, anders US
  let watchLink = null;
  if (d?.sources?.length) {
    const nlSub = d.sources.find(s => s.region==='NL' && s.type==='sub');
    const usSub = d.sources.find(s => s.region==='US' && s.type==='sub');
    const nlAny = d.sources.find(s => s.region==='NL');
    watchLink = nlSub?.web_url || usSub?.web_url || nlAny?.web_url || d.sources[0]?.web_url || null;
  }
  if (!watchLink) {
    const svc = (item?._src?.name||'').toLowerCase();
    if (svc.includes('netflix'))                     watchLink = `https://www.netflix.com/search?q=${encodeURIComponent(fullTitle)}`;
    else if (svc.includes('prime')||svc.includes('amazon')) watchLink = `https://www.amazon.nl/s?k=${encodeURIComponent(fullTitle)}`;
    else if (svc.includes('disney'))                 watchLink = `https://www.disneyplus.com/search/${encodeURIComponent(fullTitle)}`;
    else if (svc.includes('apple'))                  watchLink = `https://tv.apple.com/`;
    else if (svc.includes('max')||svc.includes('hbo')) watchLink = `https://www.max.com/`;
    else if (svc.includes('paramount'))              watchLink = `https://www.paramountplus.com/`;
    else if (svc.includes('peacock'))                watchLink = `https://www.peacocktv.com/`;
    else if (svc.includes('hulu'))                   watchLink = `https://www.hulu.com/`;
    else if (svc.includes('videoland'))              watchLink = `https://www.videoland.com/`;
  }

  const rawDesc = d?.plot_overview || item?.overview || '';
  const desc    = await translateToNL(rawDesc);

  si.innerHTML = `
    <div class="sp">${posterUrl ? `<img src="${posterUrl}" alt="">` : ''}</div>
    <div class="sinf">
      <div class="ssvc" style="color:${style.color}">${svcName}</div>
      <div class="stitle">${fullTitle}</div>
      <div class="smeta">${type==='movie'?'üéû Film':'üì° Serie'}${year?' ¬∑ '+year:''}${runtime?' ¬∑ '+runtime:''}</div>
      <div class="stags">${genres}</div>
      ${rating ? `<div class="srating"><span style="color:#FFD60A">‚òÖ</span> ${rating}</div>` : ''}
    </div>`;
  sd.textContent = desc || 'Geen beschrijving beschikbaar.';
  if (watchLink) { wb.href = watchLink; wb.style.display = 'flex'; }
}

function closeBg(e) {
  if (e.target === document.getElementById('overlay')) {
    document.getElementById('overlay').classList.remove('open');
    document.body.style.overflow = '';
  }
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ
async function init() {
  try {
    setTxt('Streamingdiensten ophalen‚Ä¶');
    await fetchSources();
    if (!sources.length) throw new Error('Geen streamingdiensten gevonden.');
    setTxt('Originals ophalen‚Ä¶');
    await fetchReleases();
    buildSvcBar();
    buildDayList();
    renderAll();
  } catch(e) {
    console.error(e);
    document.getElementById('main').innerHTML = `
      <div class="error-screen">
        <div class="error-icon">‚ö†Ô∏è</div>
        <div class="error-title">Kon releases niet laden</div>
        <div class="error-msg">${e.message||'Controleer je internetverbinding.'}</div>
        <button class="retry-btn" onclick="location.reload()">Opnieuw proberen</button>
      </div>`;
  }
}
init();
</script>

</body>
</html>